/**
 * ******************************************************************************************
 * 1：基本信息：
 * 开源协议：https://github.com/xucongli1989/XGoAjax/blob/master/LICENSE
 * 项目地址：https://github.com/xucongli1989/XGoAjax
 * 电子邮件：80213876@qq.com
 * Create By: XCL @ 2015.09 in Shenzhen. China
 ********************************************************************************************
 * 2：使用说明：
 *                      统一对ajax请求的结果进行处理，包括消息提示、错误处理等操作，这样可以保证我们的项目有一个统一的风格，同时也简化了大量的代码。
 * 3：使用场景：
 *                      a：ajax回调信息提示响应处理，比如提示成功或失败等消息。
 *                      b：提交按钮需要在ajax请求中阻止提交（防止多次提交）
 *                      c：同时发起多次ajax请求
 * 当前版本：v1.0.5
 * 更新时间：2017-04-07
 * 更新内容：默认的form改为先读取target同一容器中的form，若没有则取页面的第一个form
 */
; (function (n, t, i) { "use strict"; var u = {}, o = {}, c = { name: "", before: function () { return !0 }, error: function () { }, success: function () { }, complete: function () { }, templateOption: {} }, s = { id: "", templateName: "", templateOption: {}, isExclusive: !0, ajax: [], target: null, targetOption: {}, preBefore: null, before: null, postBefore: null, preSuccess: null, success: null, postSuccess: null, preComplete: null, complete: null, postComplete: null, preError: null, error: null, postError: null }, h = { url: "", dataType: "JSON", type: "get", data: null }, f = {}, l = function (n, t) { n && (f[n] = t) }, a = function (n) { return f[n] || null }, v = function (n) { delete f[n] }, e = function () { return i.Callbacks("stopOnFalse unique") }, r = function (t) { var y, w; t = i.extend({}, s, t || {}); var f = null, c = !0, r = o[t.templateName || "default"], u = null; t.target && (u = i(t.target).closest("form")); u && u.length != 0 || (u = i("form:first")); var b = u.attr("action"), k = u.serialize(), d = u.attr("method"); if (!r) throw new Error("请指定一个有效的模板！"); if (t.ajax && !i.isArray(t.ajax) && (t.ajax = [t.ajax]), t.ajax && t.ajax.length != 0 ? i.each(t.ajax, function (r, u) { u.url = (u.url ? u.url : b) || n.location.href; u.data = u.data ? u.data : k; u.type = (u.type ? u.type : d) || "get"; t.ajax[r] = i.extend({}, h, u) }) : (t.ajax = [{ url: b || n.location.href, data: k, type: d || "get" }], t.ajax[0] = i.extend({}, h, t.ajax[0])), t.templateOption = i.extend({}, r.templateOption, t.templateOption), t.isExclusive) { if (!t.id) throw new Error("Error：独占请求必须指定有效的id！"); y = a(t.id); y && y.state() === "pending" && (c = !1) } var p = !1, nt = function (n) { var t = e(); n.preBefore && t.add(n.preBefore); n.before && t.add(n.before); r.before && t.add(r.before); n.postBefore && t.add(n.postBefore); t.add(function () { p = !0 }); t.fire(n) }, tt = function (n, t) { var i = e(); n.preSuccess && i.add(n.preSuccess); n.success && i.add(n.success); r.success && i.add(r.success); n.postSuccess && i.add(n.postSuccess); i.fire(n, t) }, it = function (n) { var t = e(); n.preError && t.add(n.preError); n.error && t.add(n.error); r.error && t.add(r.error); n.postError && t.add(n.postError); t.fire(n) }, g = function (n) { var t = e(); n.preComplete && t.add(n.preComplete); n.complete && t.add(n.complete); r.complete && t.add(r.complete); n.postComplete && t.add(n.postComplete); t.fire(n) }; return c && nt.call(this, t), c && p && (w = [], i.each(t.ajax, function (n, t) { w.push(i.ajax(t)) }), f = i.when.apply(i, w).done(function () { for (var n = [], f = arguments, r = null, u = 0; u < t.ajax.length; u++) r = t.ajax.length > 1 ? f[u][0] : f[0], t.ajax[u].dataType.toUpperCase() !== "JSON" || r instanceof Object ? n.push(r) : n.push(i.parseJSON(r)); t.ajax.length == 1 && (n = n[0]); tt.call(this, t, n) }).always(function () { v(t.id); g.call(this, t) }).fail(function () { it.call(this, t) }), l(t.id, f)), c && !p && g.call(null, t), t.getState = function () { return f ? f.state() : null }, f ? f : null }; r.version = "v1.0.5，https://github.com/xucongli1989/XGoAjax"; r.addTemplate = function (n) { if (n.name) o[n.name] = i.extend({}, c, n); else throw new Error("必须指定有效的模板名！"); }; r.getAjaxList = function () { return f }; r.getTemplate = function (n) { return o[n] || null }; r.globalSettings = function (n) { u = i.extend({ templateName: "default", isExclusive: !0 }, n || {}); s.templateName = u.templateName; s.isExclusive = u.isExclusive }; r.globalSettings(); r.getGlobalSettings = function () { return u || null }; i.extend({ XGoAjax: r }) })(window, document, jQuery);